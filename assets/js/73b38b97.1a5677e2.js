"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9809],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),c=s(n),m=r,h=c["".concat(l,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=m;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p[c]="string"==typeof e?e:r,o[1]=p;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9890:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>p,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const i={title:"Payment API",sidebar_label:"Payment API",sidebar_position:2},o=void 0,p={unversionedId:"dev-guides/integration-api/api",id:"dev-guides/integration-api/api",title:"Payment API",description:"API invocation method",source:"@site/docs/dev-guides/integration-api/api.md",sourceDirName:"dev-guides/integration-api",slug:"/dev-guides/integration-api/api",permalink:"/docs/dev-guides/integration-api/api",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Payment API",sidebar_label:"Payment API",sidebar_position:2},sidebar:"defaultSidebar",previous:{title:"Payment page",permalink:"/docs/dev-guides/integration-page/page"},next:{title:"Authentication",permalink:"/docs/dev-guides/integration-api/authentication"}},l={},s=[{value:"API invocation method",id:"api-invocation-method",level:2},{value:"Request URI",id:"request-uri",level:3},{value:"Request method",id:"request-method",level:3},{value:"Character encoding",id:"character-encoding",level:3},{value:"Flows",id:"flows",level:2},{value:"Start integrating KlaviPay payment",id:"start-integrating-klavipay-payment",level:2},{value:"Step 1: Authentication",id:"step-1-authentication",level:3},{value:"Step 2: List Account Providers",id:"step-2-list-account-providers",level:3},{value:"Step 3: Send payment payload",id:"step-3-send-payment-payload",level:3},{value:"Step 4: Check status until completed, rejected or error",id:"step-4-check-status-until-completed-rejected-or-error",level:3}],d={toc:s},c="wrapper";function u(e){let{components:t,...i}=e;return(0,r.kt)(c,(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"api-invocation-method"},"API invocation method"),(0,r.kt)("h3",{id:"request-uri"},"Request URI"),(0,r.kt)("p",null,"The request URI consists of the following parts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{URI-scheme}://{Host}/{resource-path}?{query-string}\n")),(0,r.kt)("p",null,"Parameter description in URI:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"URI-scheme")),(0,r.kt)("td",{parentName:"tr",align:"left"},"All APIs use HTTPS protocol, only support ",(0,r.kt)("inlineCode",{parentName:"td"},"https"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"Host")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Different environments have different host:",(0,r.kt)("ul",null,(0,r.kt)("li",null,"Sandbox environment: ",(0,r.kt)("inlineCode",{parentName:"td"},"api.sandbox.klavipay.ai")),(0,r.kt)("li",null,"Production environment: ",(0,r.kt)("inlineCode",{parentName:"td"},"api.klavipay.ai"))))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"resource-path")),(0,r.kt)("td",{parentName:"tr",align:"left"},"Resource path, i.e. API access path. APIs with different functions have different resource paths. For example:The resource-path of the product API is ",(0,r.kt)("inlineCode",{parentName:"td"},"/product/v1/auth"),". The resource-path of the management API is ",(0,r.kt)("inlineCode",{parentName:"td"},"management/v1/auth"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"query-string")),(0,r.kt)("td",{parentName:"tr",align:"left"},'Query parameters are optional. Not every API has query parameters. Query parameters need to be preceded by a "?", The form is ',(0,r.kt)("inlineCode",{parentName:"td"},"parameter_name=parameter_value"),". For example, ",(0,r.kt)("inlineCode",{parentName:"td"},"?limit=10"),", which means no more than 10 pieces of data can be queried.")))),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Different environments have different host"),", only after the successful integration test in the sandbox environment can it be integrated in the production environment. "),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Sandbox environment: ",(0,r.kt)("inlineCode",{parentName:"li"},"api.sandbox.klavipay.ai/product/v1/auth")),(0,r.kt)("li",{parentName:"ul"},"Production environment: ",(0,r.kt)("inlineCode",{parentName:"li"},"api.klavipay.ai/product/v1/auth"))),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"The credentials of the production environment is different from the sandbox environment"),", please reach out to us at ",(0,r.kt)("a",{parentName:"p",href:"mailto:crie@klavi.ai"},"crie@klavi.ai"),".")),(0,r.kt)("h3",{id:"request-method"},"Request method"),(0,r.kt)("p",null,"Supported HTTP request methods: ",(0,r.kt)("inlineCode",{parentName:"p"},"POST")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"GET"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"GET")," method, only ",(0,r.kt)("inlineCode",{parentName:"li"},"content type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"application/x-www-form-url")," encoded protocol format is supported. "),(0,r.kt)("li",{parentName:"ul"},"For ",(0,r.kt)("inlineCode",{parentName:"li"},"POST")," method, only ",(0,r.kt)("inlineCode",{parentName:"li"},"content type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"application/JSON"),"  is supported at present.")),(0,r.kt)("h3",{id:"character-encoding"},"Character encoding"),(0,r.kt)("p",null,"UTF-8 coding."),(0,r.kt)("h2",{id:"flows"},"Flows"),(0,r.kt)("p",null,"The partner integration KlaviPay sequence diagrams is as follows:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"API diagram",src:n(4302).Z,width:"711",height:"601"})),(0,r.kt)("h2",{id:"start-integrating-klavipay-payment"},"Start integrating KlaviPay payment"),(0,r.kt)("h3",{id:"step-1-authentication"},"Step 1: Authentication"),(0,r.kt)("p",null,"Before request the KlaviPay API, you must first obtain a JWT bearer token by request the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth"),", once you have a JWT bearer token you can submit requests on protected APIs like ",(0,r.kt)("inlineCode",{parentName:"p"},"participants")," and payments."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl \'https://sandbox.klavipay.ai/v1/auth\' \\\n-H \'Content-Type: application/json\' \\\n-d \'{\n    "accessKey": "k0l1l2v3i4",\n    "secretKey": "TtMdrH&a8Mjd9FyULnFs*#dypaX15%qpXtXQt2n$"\n}\'\n\nresponse\n{\n    "code": 200,\n    "message": "OK",\n    "data": {\n        "token": "eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsbLWdhdGV3YXkifQ.2dvWMBcU87IeX4J7S1_bx1uKHsXAvSDaK0RdV9xq3-OSrLA",\n        "expire": "2023-02-16T17:16:30.189341+08:00"\n    }\n}\n')),(0,r.kt)("p",null,"Refer:  ",(0,r.kt)("a",{parentName:"p",href:"/docs/api-reference/product/auth/authentication"},(0,r.kt)("strong",{parentName:"a"},"Authenticate initiation"))),(0,r.kt)("h3",{id:"step-2-list-account-providers"},"Step 2: List Account Providers"),(0,r.kt)("p",null,"Now that you have an access token, you can display the list of account providers participating in Open Finance to users.\nAfter the user selects his account holding institution, all you need to do is save the id for later use on the ",(0,r.kt)("inlineCode",{parentName:"p"},"payments")," API."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -L -X GET \'https://sandbox.klavipay.ai/v1/participants\' \\\n-H \'Content-Type: application/json\' \\\n-H \'Accept: application/json\' \\\n-H \'Authorization: Bearer 6IkpXVCJ9.eyJwYWdhdGV3YXkifQ.FKX8rT3jIFfeOLYTgTrzlSbOjMIMPAZipkH4VdhL-NB\'\n\nresponse\n{\n    "code": 200,\n    "message": "OK",\n    "data":\n    [\n        {\n            "id": "c8f0bf49-4744-4933-8960-7add6e590841",\n            "name": "Mock Bank",\n            "slug": "mock-bank",\n            "avatar": "https://cdn.raidiam.io/directory-ui/brand/obbrazil/0.2.0.112/favicon.svg"\n        },\n        {\n            "id": "b566e001-f5a3-4e84-9b46-ea3bcaf440b4",\n            "name": "U4C Tests",\n            "slug": "u4c-tests",\n            "avatar": "http://static.u4c-iniciador.com.br/logo.svg"\n        }\n    ]\n}\n')),(0,r.kt)("p",null,"Refer: ",(0,r.kt)("a",{parentName:"p",href:"/docs/api-reference/product/participants/participant"},(0,r.kt)("strong",{parentName:"a"},"List participants"))),(0,r.kt)("h3",{id:"step-3-send-payment-payload"},"Step 3: Send payment payload"),(0,r.kt)("p",null,"Now that you have a JWT access token and the\xa0participantId\xa0that the end-user selected, it's time to show the checkout and to get the user confirmation on the payment transaction.\nOnce confirmed, you need to send the payload of the payment to be enqueued and then processed. The example below displays the minimum payload information required:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -L -X POST \'https://sandbox.klavipay.ai/v1/payments\' \\\n-H \'Accept: application/json\' \\\n-H \'Authorization: Bearer 6IkpXVCJ9.eyJwYWdhdGV3YXkifQ.FKX8rT3jIFfeOLYTgTrzlSbOjMIMPAZipkH4VdhL-NB \' \\\n--data-raw \'{\n    "externalId": "345590908",\n    "participantId": "ef7320c1-6f96-4af5-9446-92a081b7eac9",\n    "redirectURL": "https://app.sandbox.inic.dev/pag-receipt",\n    "user":\n    {\n        "name": "dang wenyun",\n        "taxId": "12345678901"\n    },\n    "method": "PIX_INIC",\n    "amount": 133300,\n    "date": "2023-02-16"\n}\'\n\nresponse\n{\n    "code": 409,\n    "message": "{ externalId, clientId } can not be duplicated, try another one.",\n    "data": null\n}\n')),(0,r.kt)("p",null,"Refer: ",(0,r.kt)("a",{parentName:"p",href:"/docs/api-reference/product/payments/create-payment"},(0,r.kt)("strong",{parentName:"a"},"Create a payment initiation"))),(0,r.kt)("h3",{id:"step-4-check-status-until-completed-rejected-or-error"},"Step 4: Check status until completed, rejected or error"),(0,r.kt)("p",null,"Congratulations, you have now sent the payload of the payment initiation!\nNow you can check the payment initiation status through the endpoint ",(0,r.kt)("inlineCode",{parentName:"p"},"/v1/payments/:id/status"),".\nIt only returns information to direct your next steps. Polling should be done in 1s intervals.\nA happy path should display the responses below, in this exact order:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -L -X GET \'https://sandbox.klavipay.ai/v1/payments/fcb72e3a-b346-4f71-b044-971dc23232c9/status\' \\\n-H \'Accept: application/json\' \\\n-H \'Authorization: Bearer 6IkpXVCJ9.eyJwYWdhdGV3YXkifQ.FKX8rT3jIFfeOLYTgTrzlSbOjMIMPAZipkH4VdhL-NB\'\n\nresponse\n{\n    "code": 200,\n    "message": "OK",\n    "data": {\n        "id": "e8a1f1e1-cfe3-41b9-84c1-8653f645e58a",\n        "createdAt": "2022-09-23T19:57:38.478Z",\n        "updatedAt": "2022-09-23T19:58:18.591Z",\n        "consentId": "urn:raidiambank:baa1479d-1af0-41f1-9a6a-82512796c003",\n        "endToEndId": "E30980539202209231958U824f4f92b8",\n        "status": "PAYMENT_REJECTED",\n        "externalId": "345590908",\n        "errors": [\n            {\n                "code": "DETALHE_PGTO_INVALIDO",\n                "detail": "DETALHE_PGTO_INVALIDO",\n                "title": "Detalhe do pagamento inv\xe1lido."\n            }\n        ]\n    }\n}\n')),(0,r.kt)("p",null,"Refer:  ",(0,r.kt)("a",{parentName:"p",href:"/docs/api-reference/product/payments/get-status"},(0,r.kt)("strong",{parentName:"a"},"Get the payment status"))),(0,r.kt)("p",null,"If there is any problem in the integration, we will provide support in the way you think is most appropriate, not limited to Slack, Teams or email, please reach out to us at ",(0,r.kt)("a",{parentName:"p",href:"mailto:crie@klavi.ai"},"crie@klavi.ai"),"."))}u.isMDXComponent=!0},4302:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/integrationWithAPI-b999148c409a2bfe5dcacda6d398732e.jpg"}}]);